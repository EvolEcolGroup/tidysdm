<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Calibrate class thresholds — calib_class_thresh • tidysdm</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Calibrate class thresholds — calib_class_thresh"><meta name="description" content="Calibrate the probability thresholds that convert probabilities into classes
for a simple ensemble object. This is done by generating predictions for the
training data, and then optimizing the threshold according to the metric
given in class_thresh. The calibration depends on how the ensemble is
pruned, which is defined by metric_thresh, and how predictions are
combined. calib_class_threshold considers the four possible combining
options available via the parameter fun in predict.simple_ensemble; note
that the weighted functions weighted_mean and weighted_median use weights
based on the metric used to tune the ensemble, and so they might make little
sense if used in conjunction with a different metric. The updated simple
ensemble contains information on the optimal thresholds for the given
combination of class_thresh, metric_thresh and fun, and these will be
used when predicting classes with predict.simple_ensemble."><meta property="og:description" content="Calibrate the probability thresholds that convert probabilities into classes
for a simple ensemble object. This is done by generating predictions for the
training data, and then optimizing the threshold according to the metric
given in class_thresh. The calibration depends on how the ensemble is
pruned, which is defined by metric_thresh, and how predictions are
combined. calib_class_threshold considers the four possible combining
options available via the parameter fun in predict.simple_ensemble; note
that the weighted functions weighted_mean and weighted_median use weights
based on the metric used to tune the ensemble, and so they might make little
sense if used in conjunction with a different metric. The updated simple
ensemble contains information on the optimal thresholds for the given
combination of class_thresh, metric_thresh and fun, and these will be
used when predicting classes with predict.simple_ensemble."><meta property="og:image" content="https://evolecolgroup.github.io/tidysdm/logo.png"><meta name="robots" content="noindex"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">tidysdm</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.0.3.9002</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/tidysdm.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/a1_palaeodata_application.html">Application with palaeodata</a></li>
    <li><a class="dropdown-item" href="../articles/a2_tidymodels_additions.html">Examples of additional tidymodels features</a></li>
    <li><a class="dropdown-item" href="../articles/a3_troubleshooting.html">Troubleshooting models that fail</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/EvolEcolGroup/tidysdm/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Calibrate class thresholds</h1>
      <small class="dont-index">Source: <a href="https://github.com/EvolEcolGroup/tidysdm/blob/dev/R/calib_class_thresh.R" class="external-link"><code>R/calib_class_thresh.R</code></a></small>
      <div class="d-none name"><code>calib_class_thresh.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Calibrate the probability thresholds that convert probabilities into classes
for a simple ensemble object. This is done by generating predictions for the
training data, and then optimizing the threshold according to the metric
given in <code>class_thresh</code>. The calibration depends on how the ensemble is
pruned, which is defined by <code>metric_thresh</code>, and how predictions are
combined. <code>calib_class_threshold</code> considers the four possible combining
options available via the parameter <code>fun</code> in <a href="predict.simple_ensemble.html">predict.simple_ensemble</a>; note
that the weighted functions <code>weighted_mean</code> and <code>weighted_median</code> use weights
based on the metric used to tune the ensemble, and so they might make little
sense if used in conjunction with a different metric. The updated simple
ensemble contains information on the optimal thresholds for the given
combination of <code>class_thresh</code>, <code>metric_thresh</code> and <code>fun</code>, and these will be
used when predicting classes with <a href="predict.simple_ensemble.html">predict.simple_ensemble</a>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">calib_class_thresh</span><span class="op">(</span><span class="va">object</span>, <span class="va">class_thresh</span>, metric_thresh <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-object">object<a class="anchor" aria-label="anchor" href="#arg-object"></a></dt>
<dd><p>an simple_ensemble object</p></dd>


<dt id="arg-class-thresh">class_thresh<a class="anchor" aria-label="anchor" href="#arg-class-thresh"></a></dt>
<dd><p>probability threshold used to convert probabilities into
classes. It can be a number (between 0 and 1), or a character metric
(currently "tss_max", "kap_max" or "sensitivity"). For sensitivity, an
additional target value is passed along as a second element of a vector,
e.g. c("sensitivity",0.8).</p></dd>


<dt id="arg-metric-thresh">metric_thresh<a class="anchor" aria-label="anchor" href="#arg-metric-thresh"></a></dt>
<dd><p>a vector of length 2 giving a metric and its threshold,
which will be used to prune which models in the ensemble will be used for
the prediction. The 'metrics' need to have been computed when the workflow
was tuned. The metric's threshold needs to match the value used during
prediction. Examples are c("accuracy",0.8) or c("boyce_cont",0.7).</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>a <a href="simple_ensemble.html">simple_ensemble</a> object with an additional attribute
<code>class_thresholds</code>, which is a tibble with columns:</p><ul><li><p><code>class_thresh</code>: the value passed to <code>class_thresh</code></p></li>
<li><p><code>metric_thresh</code>: the value passed to <code>metric_thresh</code></p></li>
<li><p><code>fun</code>: the aggregating function used to combine predictions</p></li>
<li><p><code>optim_value</code>: the optimal threshold for the given combination of
<code>class_thresh</code>, <code>metric_thresh</code> and <code>fun</code></p></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">test_ens</span> <span class="op">&lt;-</span> <span class="fu"><a href="simple_ensemble.html">simple_ensemble</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="add_member.html">add_member</a></span><span class="op">(</span><span class="va">two_class_res</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="op">]</span>, metric <span class="op">=</span> <span class="st">"roc_auc"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">test_ens</span> <span class="op">&lt;-</span> <span class="fu">calib_class_thresh</span><span class="op">(</span><span class="va">test_ens</span>, class_thresh <span class="op">=</span> <span class="st">"tss_max"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">test_ens</span> <span class="op">&lt;-</span> <span class="fu">calib_class_thresh</span><span class="op">(</span><span class="va">test_ens</span>, class_thresh <span class="op">=</span> <span class="st">"kap_max"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">test_ens</span> <span class="op">&lt;-</span> <span class="fu">calib_class_thresh</span><span class="op">(</span><span class="va">test_ens</span>, class_thresh <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sens"</span>, <span class="fl">0.9</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="collect_class_thresh.html">collect_class_thresh</a></span><span class="op">(</span><span class="va">test_ens</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 12 × 4</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    class_thresh metric_thresh fun             optim_value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span> <span style="color: #949494;">&lt;chr [1]&gt;</span>    <span style="color: #949494;">&lt;NULL&gt;</span>        mean                  0.544</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span> <span style="color: #949494;">&lt;chr [1]&gt;</span>    <span style="color: #949494;">&lt;NULL&gt;</span>        median                0.545</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span> <span style="color: #949494;">&lt;chr [1]&gt;</span>    <span style="color: #949494;">&lt;NULL&gt;</span>        weighted_mean         0.544</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span> <span style="color: #949494;">&lt;chr [1]&gt;</span>    <span style="color: #949494;">&lt;NULL&gt;</span>        weighted_median       0.447</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span> <span style="color: #949494;">&lt;chr [1]&gt;</span>    <span style="color: #949494;">&lt;NULL&gt;</span>        mean                  0.544</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span> <span style="color: #949494;">&lt;chr [1]&gt;</span>    <span style="color: #949494;">&lt;NULL&gt;</span>        median                0.451</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span> <span style="color: #949494;">&lt;chr [1]&gt;</span>    <span style="color: #949494;">&lt;NULL&gt;</span>        weighted_mean         0.544</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span> <span style="color: #949494;">&lt;chr [1]&gt;</span>    <span style="color: #949494;">&lt;NULL&gt;</span>        weighted_median       0.447</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span> <span style="color: #949494;">&lt;chr [2]&gt;</span>    <span style="color: #949494;">&lt;NULL&gt;</span>        mean                  0.350</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span> <span style="color: #949494;">&lt;chr [2]&gt;</span>    <span style="color: #949494;">&lt;NULL&gt;</span>        median                0.351</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">11</span> <span style="color: #949494;">&lt;chr [2]&gt;</span>    <span style="color: #949494;">&lt;NULL&gt;</span>        weighted_mean         0.350</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">12</span> <span style="color: #949494;">&lt;chr [2]&gt;</span>    <span style="color: #949494;">&lt;NULL&gt;</span>        weighted_median       0.310</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Michela Leonardi, Margherita Colucci, Andrea Vittorio Pozzi, Eleanor M.L. Scerri, Andrea Manica.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

